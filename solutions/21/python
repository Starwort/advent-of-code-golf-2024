from functools import*
L=*open(0),
@cache
def F(s,r):(B,_),*w=[divmod("789456123_0A<v>".find(c),3)for c in"_A"+s];return r<1or sum(F(("<"*(x-X)+"v0"[Y<y]*abs(y-Y)+">"*(X-x))[::0<(x|Y^B)*(X|y^B)or-1]+"A",r-1)for(y,x),(Y,X)in zip(w,w[1:]))
for n in 4,27:print(sum(int(l[:3])*F(l.strip(),n)for l in L))