from collections import*
q=open(0).read();g='s({e:(i%3,i//3)for i,e in enumerate("'
def s(G,j,i):
 p,y=G["A"];a,b=G[" "];r=Counter()
 for c in j:X,Y=G[c];r[X-p,Y-y,(X==a and y==b)or(Y==b and p==a)]+=i;p,y=X,Y
 return r
for n in 3,26:
 r=0
 for c in q.split():exec(f'R={g}789456123 0A")}},c,1);'+f'R=sum(({g} ^A<v>")}},("<"*-x+"v"*y+"^"*-y+">"*x)[::-f|1]+"A",R[x,y,f])for x,y,f in R),Counter());'*n);r+=R.total()*int(c[:3])
 print(r)