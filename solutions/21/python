from collections import*
q=open(0).read();w=enumerate
def s(G,j,i):
 p,y=G["A"];a,b=G[" "];r=Counter()
 for c in j:X,Y=G[c];r[X-p,Y-y,(X==a and y==b)or(Y==b and p==a)]+=i;p,y=X,Y
 return r
for n in 3,26:
 r=0
 for c in q.split():R=s({e:(i%3,i//3)for i,e in w("789456123 0A")},c,1);exec('R=sum((s({e:(i%3,i//3)for i,e in w(" ^A<v>")},("<"*-x+"v"*y+"^"*-y+">"*x)[::-f|1]+"A",R[x,y,f])for x,y,f in R),Counter());'*n);r+=R.total()*int(c[:3])
 print(r)