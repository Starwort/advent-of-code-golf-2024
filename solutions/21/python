from functools import*
L=*open(0),
@cache
def F(s,r):w=[divmod("789456123_0A<v>".find(c),3)for c in"A"+s+"A"];return r<1or sum(F(("<"*(x-X)+"v0"[Y<y]*abs(y-Y)+">"*(X-x))[::0<(x|Y^3)*(X|y^3)or-1],r-1)for(y,x),(Y,X)in zip(w,w[1:]))
for n in 4,27:print(sum(int(s:=l[:3])*F(s,n)for l in L))