D,M=open(0).read().split('\n\n')
S=lambda p,d:'O'==G[p:=p+d]and S(p,d)or'['==G[p]and(S(p+1,d)or S(p,d))or'['<G[p]and(S(p-1,d)or S(p,d))or'$'>G[p]or exec("G[p],G[p-d]=G[p-d],G[p]")
for l in b'3e':
 G=dict(enumerate(D));p=D.find('@')
 for m in M:C=G|G;d=[0,1,-l,l,-1][ord(m)%23%5];S(p,d)and(G:=C)or(p:=p+d)
 print(sum(p%l+p//l*100for p in G if G[p]in'O['));D=D.translate({35:'##',46:'..',79:'[]',64:'@.'})